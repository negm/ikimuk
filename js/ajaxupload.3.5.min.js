(function(){var a=document,c=window;function n(b){if(typeof b=="string")b=a.getElementById(b);return b}function b(a,b,d){if(c.addEventListener)a.addEventListener(b,d,false);else if(c.attachEvent){var e=function(){d.call(a,c.event)};a.attachEvent("on"+b,e)}}var g=function(){var b=a.createElement("div");return function(c){b.innerHTML=c;var a=b.childNodes[0];b.removeChild(a);return a}}();function k(b,a){return b.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))}function j(b,a){if(!k(b,a))b.className+=" "+a}function e(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}if(document.documentElement.getBoundingClientRect)var f=function(i){var g=i.getBoundingClientRect(),h=i.ownerDocument,b=h.body,c=h.documentElement,e=c.clientTop||b.clientTop||0,d=c.clientLeft||b.clientLeft||0,a=1;if(b.getBoundingClientRect){var f=b.getBoundingClientRect();a=(f.right-f.left)/b.clientWidth}if(a>1){e=0;d=0}var k=g.top/a+(window.pageYOffset||c&&c.scrollTop/a||b.scrollTop/a)-e,j=g.left/a+(window.pageXOffset||c&&c.scrollLeft/a||b.scrollLeft/a)-d;return{top:k,left:j}};else var f=function(a){if(c.jQuery)return jQuery(a).offset();var d=0,b=0;do{d+=a.offsetTop||0;b+=a.offsetLeft||0}while(a=a.offsetParent);return{left:b,top:d}};function l(c){var a,g,b,d,e=f(c);a=e.left;b=e.top;g=a+c.offsetWidth;d=b+c.offsetHeight;return{left:a,right:g,top:b,bottom:d}}function i(b){if(!b.pageX&&b.clientX){var d=1,c=document.body;if(c.getBoundingClientRect){var e=c.getBoundingClientRect();d=(e.right-e.left)/c.clientWidth}return{x:b.clientX/d+a.body.scrollLeft+a.documentElement.scrollLeft,y:b.clientY/d+a.body.scrollTop+a.documentElement.scrollTop}}return{x:b.pageX,y:b.pageY}}var m=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();function d(a){return a.replace(/.*(\/|\\)/,"")}function h(a){return/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):""}Ajax_upload=AjaxUpload=function(b,d){if(b.jquery)b=b[0];else if(typeof b=="string"&&/^#.*/.test(b))b=b.slice(1);b=n(b);this._input=null;this._button=b;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=a.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var c=jQuery(this._button).parents(".ui-dialog");if(c.length)this._parentDialog=c[0]}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,responseType:false,onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(var e in d)this._settings[e]=d[e];this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){this._input.parentNode&&this._input.parentNode.removeChild(this._input);this._input=null}},_createInput:function(){var e=this,c=a.createElement("input");c.setAttribute("type","file");c.setAttribute("name",this._settings.name);var f={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(var g in f)c.style[g]=f[g];if(!(c.style.opacity==="0"))c.style.filter="alpha(opacity=0)";this._parentDialog.appendChild(c);b(c,"change",function(){var a=d(this.value);if(e._settings.onChange.call(e,a,h(a))==false)return;e._settings.autoSubmit&&e.submit()});b(c,"click",function(){e.justClicked=true;setTimeout(function(){e.justClicked=false},3e3)});this._input=c},_rerouteClicks:function(){var c=this,d,h={top:0,left:0},g=false;b(c._button,"mouseover",function(){if(!c._input||g)return;g=true;d=l(c._button);if(c._parentDialog!=a.body)h=f(c._parentDialog)});b(document,"mousemove",function(f){var a=c._input;if(!a||!g)return;if(c._disabled){e(c._button,"hover");a.style.display="none";return}var b=i(f);if(b.x>=d.left&&b.x<=d.right&&b.y>=d.top&&b.y<=d.bottom){a.style.top=b.y-h.top+"px";a.style.left=b.x-h.left+"px";a.style.display="block";j(c._button,"hover")}else{g=false;if(!c.justClicked)a.style.display="none";e(c._button,"hover")}})},_createIframe:function(){var c=m(),b=g('<iframe src="javascript:false;" name="'+c+'" />');b.id=c;b.style.display="none";a.body.appendChild(b);return b},submit:function(){var j=this,e=this._settings;if(this._input.value==="")return;var g=d(this._input.value);if(!(e.onSubmit.call(this,g,h(g))==false)){var c=this._createIframe(),f=this._createForm(c);f.appendChild(this._input);f.submit();a.body.removeChild(f);f=null;this._input=null;this._createInput();var i=false;b(c,"load",function(){if(c.src=="javascript:'%3Chtml%3E%3C/html%3E';"||c.src=="javascript:'<html></html>';"){i&&setTimeout(function(){a.body.removeChild(c)},0);return}var b=c.contentDocument?c.contentDocument:frames[c.id].document;if(b.readyState&&b.readyState!="complete")return;if(b.body&&b.body.innerHTML=="false")return;var d;if(b.XMLDocument)d=b.XMLDocument;else if(b.body){d=b.body.innerHTML;if(e.responseType&&e.responseType.toLowerCase()=="json"){if(b.body.firstChild&&b.body.firstChild.nodeName.toUpperCase()=="PRE")d=b.body.firstChild.firstChild.nodeValue;if(d)d=window.eval("("+d+")");else d={}}}else var d=b;e.onComplete.call(j,g,d);i=true;c.src="javascript:'<html></html>';"})}else{a.body.removeChild(this._input);this._input=null;this._createInput()}},_createForm:function(f){var d=this._settings,b=g('<form method="post" enctype="multipart/form-data"></form>');b.style.display="none";b.action=d.action;b.target=f.name;a.body.appendChild(b);for(var e in d.data){var c=a.createElement("input");c.type="hidden";c.name=e;c.value=d.data[e];b.appendChild(c)}return b}}})()